<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Convert-IA Reclutamiento</title>
    <meta name="description" content="Plataforma de reclutamiento impulsada por inteligencia artificial" />
    <meta name="author" content="Convert-IA" />
    <link rel="icon" href="/lovable-uploads/e0944ff1-6821-41aa-840e-6412963e6eaa.png" type="image/png">

    <meta property="og:title" content="Convert-IA Reclutamiento" />
    <meta property="og:description" content="Plataforma de reclutamiento impulsada por inteligencia artificial" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/lovable-uploads/e0944ff1-6821-41aa-840e-6412963e6eaa.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@convert_ia" />
    <meta name="twitter:image" content="/lovable-uploads/e0944ff1-6821-41aa-840e-6412963e6eaa.png" />
  </head>

  <body>
    <div id="root"></div>
    <!-- Formulario para subir CV -->
    <h2>Subir CV en PDF</h2>
    <input type="file" id="pdfInput" accept="application/pdf" />
    <button onclick="analyzeCV()">Analizar CV</button>
    <pre id="result"></pre>

    <!-- IMPORTANT: DO NOT REMOVE THIS SCRIPT TAG OR THIS VERY COMMENT! -->
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    <script type="module" src="/src/main.tsx"></script>

    <script>
      async function analyzeCV() {
        const fileInput = document.getElementById("pdfInput");
        const resultElement = document.getElementById("result");

        if (!fileInput.files.length) {
          alert("Selecciona un archivo PDF");
          return;
        }

        const file = fileInput.files[0];
        if (file.type !== "application/pdf") {
          alert("Debe ser un archivo PDF");
          return;
        }

        // Leer como base64
        const base64 = await toBase64(file);
        const base64Data = base64.split(',')[1]; // eliminar encabezado

        // Solicitar a la función Edge de Supabase
        try {
          const response = await fetch("https://<your-supabase-url>/functions/v1/extract-pdf-text", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              pdfBase64: base64Data
            })
          });

          if (!response.ok) {
            const error = await response.json();
            throw new Error(error.error || "Error al procesar el CV");
          }

          const data = await response.json();
          const content = data.text;
          resultElement.textContent = content;

        } catch (err) {
          resultElement.textContent = `❌ Error: ${err.message}`;
        }
      }

      function toBase64(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result);
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      }
    </script>
  </body>
</html>
