<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Convert-IA Reclutamiento</title>
    <meta name="description" content="Plataforma de reclutamiento impulsada por inteligencia artificial" />
    <meta name="author" content="Convert-IA" />
    <link rel="icon" href="/lovable-uploads/e0944ff1-6821-41aa-840e-6412963e6eaa.png" type="image/png">

    <meta property="og:title" content="Convert-IA Reclutamiento" />
    <meta property="og:description" content="Plataforma de reclutamiento impulsada por inteligencia artificial" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/lovable-uploads/e0944ff1-6821-41aa-840e-6412963e6eaa.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@convert_ia" />
    <meta name="twitter:image" content="/lovable-uploads/e0944ff1-6821-41aa-840e-6412963e6eaa.png" />
  </head>

  <body>
    <div id="root"></div>
    <!-- Formulario para subir CV -->
    <h2>Subir CV en PDF</h2>
    <input type="file" id="pdfInput" accept="application/pdf" />
    <button onclick="analyzeCV()">Analizar CV</button>
    <pre id="result"></pre>

    <!-- IMPORTANT: DO NOT REMOVE THIS SCRIPT TAG OR THIS VERY COMMENT! -->
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    <script type="module" src="/src/main.tsx"></script>

    <script>
      async function analyzeCV() {
        const fileInput = document.getElementById("pdfInput");
        const resultElement = document.getElementById("result");

        if (!fileInput.files.length) {
          alert("Selecciona un archivo PDF");
          return;
        }

        const file = fileInput.files[0];
        if (file.type !== "application/pdf") {
          alert("Debe ser un archivo PDF");
          return;
        }

        // Leer como base64
        const base64 = await toBase64(file);
        const base64Data = base64.split(',')[1]; // eliminar encabezado

        // Construir solicitud a OpenAI GPT-4o
        const OPENAI_API_KEY = "TU_API_KEY_AQUI"; // 🔒 pon tu clave aquí o usa un backend proxy seguro

        const body = {
          model: "gpt-4o",
          messages: [
            {
              role: "system",
              content: "Eres un experto en análisis de currículums. Extrae y estructura la información de forma clara en secciones: Datos personales, Resumen, Experiencia, Educación, Habilidades, Certificaciones, Idiomas, y otra información relevante."
            },
            {
              role: "user",
              content: [
                {
                  type: "image_url",
                  image_url: {
                    url: `data:application/pdf;base64,${base64Data}`,
                  }
                },
                {
                  type: "text",
                  text: "Por favor, analiza el contenido del CV adjunto y organiza la información."
                }
              ]
            }
          ],
          max_tokens: 2000
        };

        try {
          const response = await fetch("https://api.openai.com/v1/chat/completions", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${OPENAI_API_KEY}`
            },
            body: JSON.stringify(body)
          });

          if (!response.ok) {
            const error = await response.json();
            throw new Error(JSON.stringify(error, null, 2));
          }

          const data = await response.json();
          const content = data.choices[0].message.content;
          resultElement.textContent = content;

        } catch (err) {
          resultElement.textContent = `❌ Error: ${err.message}`;
        }
      }

      function toBase64(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result);
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      }
    </script>
  </body>
</html>
